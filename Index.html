<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Form Input Dokumen</title>
</head>
<body>

<h3>Form Input Dokumen</h3>
<form id="form"></form>
<button onclick="kirim()">Kirim</button>

<script>
async function kirim() {
  const inputs = document.querySelectorAll("#form input");
  const payload = {
    text1: inputs[0].value,
    text2: inputs[1].value,
    number: inputs[2].value,
    files: []
  };

  for (let i = 3; i < inputs.length; i++) {
    const files = [];

    for (const file of inputs[i].files) {
      const base64 = await toBase64(file);
      files.push({
        name: file.name,
        type: file.type,
        size: file.size,
        content: base64
      });
    }

    payload.files.push(files);
  }

  fetch(url, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(() => {
    alert("Data berhasil dikirim");
    window.location.href = "terimakasih.html";
  });
}
</script>


<script>
const url = "https://script.google.com/macros/s/AKfycbzaca1bjGDmMc7E969W-oX7hyfHJxyJbJdd5lkbnGMgXVNtp_imw1EqT6FWUOgBLQI/exec";
let fieldConfig = [];

fetch(url)
  .then(res => res.json())
  .then(fields => {
    fieldConfig = fields;
    fields.forEach((f, i) => {
      const label = document.createElement("label");
      label.innerText = f.name;
      form.appendChild(label);
      form.appendChild(document.createElement("br"));

      let input = document.createElement("input");
      input.type = f.type === "file" ? "file" : f.type;
      input.id = "field" + i;

      if (f.type === "file") {
        input.multiple = true;
        input.accept = "*/*";
        input.onchange = () => previewFiles(input, i);
      }

      input.required = true;
      form.appendChild(input);

      const preview = document.createElement("div");
      preview.id = "preview" + i;
      preview.style.fontSize = "12px";
      form.appendChild(preview);

      form.appendChild(document.createElement("br"));
      form.appendChild(document.createElement("br"));
    });
  });

function previewFiles(input, index) {
  const preview = document.getElementById("preview" + index);
  preview.innerHTML = "";

  Array.from(input.files).forEach(file => {
    if (file.size > 5 * 1024 * 1024) {
      alert(`File ${file.name} lebih dari 5 MB`);
      input.value = "";
      return;
    }

    const item = document.createElement("div");
    item.innerText = `âœ” ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
    preview.appendChild(item);
  });
}
</script>

</body>
</html>
